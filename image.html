<!-- Endless Adventures | a website by Ananya Ohrie where users can upload images to find the location that
    the image was taken at, shown in Google Maps, as well as the make and model of the device it was taken
    on. There is also a picture gallery of pictures from my own travels that users can filter through to gain
    inspirtation for their next adventure!
-->

<html>
    <head>
        <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
        <title> Endless Adventures </title> 
        <link rel="stylesheet" href="index.css">
    </head>
    <body>
        <img id="img1" width="200"/>
        <p> <span id="makeAndModel"></span> </p>
        <p id="mapLink"> </p>
        <input type="file" multiple onchange="getExif(this)" accept="image/jpg, image/jpeg">
        <button onClick="window.location.reload();"> Upload another picture </button>
        <br/>
        <br/>

    <script>

    function getExif(fileInput) {
        const files = fileInput.files;
        var img1 = document.getElementById('img1');
        img1.src = URL.createObjectURL(files[0]);
    }

    document.getElementById("img1").onload = function() {
        EXIF.getData(this, function() {
            myData = this;
            console.log("EXIF running");
            console.log(myData.exifdata);
            try {
                var latDegree = myData.exifdata.GPSLatitude[0];
                var latMinutes = myData.exifdata.GPSLatitude[1];
                var latSeconds = myData.exifdata.GPSLatitude[2];
                var longDegree = myData.exifdata.GPSLongitude[0];
                var longMinutes = myData.exifdata.GPSLongitude[1];
                var longSeconds = myData.exifdata.GPSLongitude[2];

                var latitude = convertToCoordinate(latDegree, latMinutes, latSeconds);
                var longitude = convertToCoordinate(longDegree, longMinutes, longSeconds);
                console.log(latitude);
                console.log(longitude);

                document.getElementById('mapLink').innerHTML = '<a href="http://www.google.com/maps/place/'+latitude+','+longitude+'" target="_blank">Google Maps Link</a>';

            } catch (err) {
                document.getElementById("mapLink").innerHTML = "The image you uploaded doesn't have any associated GPS data.";
            }

            var makeExists = false;
            var modelExists = false;
            
            if (myData.exifdata.Make) {
                makeExists = true;
                var make = myData.exifdata.Make;
            }

            if (myData.exifdata.Model) {
                modelExists = true;
                var model = myData.exifdata.Model;
            }

            if (makeExists == false && modelExists == true) {
                document.getElementById("makeAndModel").innerHTML = "The image doesn't have any associated make information. The model is " `${model}`;
            } else if (makeExists == true && modelExists == false) {
                document.getElementById("makeAndModel").innerHTML = "The image doesn't have any associated model information. The make is " `${make}`;
            } else if (makeExists == false && modelExists == false) {
                document.getElementById("makeAndModel").innerHTML = "The image you uploaded doesn't have any associated make or model information.";
            } else {
                document.getElementById("makeAndModel").innerHTML = `${make} ${model}`;
            }
            
        });
    }

    function clearAttribute() {
        console.clear();
        delete myData;
    }

    function convertToCoordinate(degree, minutes, seconds) {
        return degree + minutes/60 + seconds/3600;
    }
    </script>
    </body>
</html>

